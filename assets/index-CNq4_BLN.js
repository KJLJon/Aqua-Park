import{P as f}from"./phaser-0RJB29YE.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class _ extends f.Scene{constructor(){super({key:"BootScene"})}preload(){const t=this.add.graphics(),e=this.add.graphics(),{width:i,height:s}=this.cameras.main;e.fillStyle(2236962,.8),e.fillRoundedRect(i/2-120,s/2-15,240,30,10);const a=this.add.text(i/2,s/2-40,"Loading...",{fontSize:"20px",color:"#ffffff"}).setOrigin(.5);this.load.on("progress",n=>{t.clear(),t.fillStyle(46296,1),t.fillRoundedRect(i/2-115,s/2-10,230*n,20,8);const r=document.getElementById("progress-bar"),l=document.getElementById("progress-text");r&&(r.style.width=`${Math.floor(n*100)}%`),l&&(l.textContent=`${Math.floor(n*100)}%`)}),this.load.on("complete",()=>{t.destroy(),e.destroy(),a.destroy();const n=document.getElementById("install-progress");n&&n.classList.add("hidden")}),this.generatePlaceholderAssets()}create(){this.scene.start("MenuScene")}generatePlaceholderAssets(){const t=this.add.graphics();t.setVisible(!1),this.generatePlayerTextures(t),t.clear(),t.fillStyle(46296,1),t.fillRect(0,0,64,64),t.fillStyle(38599,1),t.fillRect(0,0,64,4),t.fillRect(0,60,64,4),t.lineStyle(1,4770532,.5);for(let e=0;e<64;e+=16)t.lineBetween(e,0,e,64);t.generateTexture("slide_tile",64,64),t.clear(),t.fillStyle(9494767,1),t.fillRect(0,0,64,64),t.fillStyle(11397364,.6);for(let e=0;e<5;e++)t.fillEllipse(10+e*12,32,8,4);t.generateTexture("water_tile",64,64),t.clear(),t.fillStyle(16556817,1),t.fillTriangle(0,64,64,64,32,0),t.generateTexture("ramp",64,64),t.clear(),t.fillStyle(9127187,1),t.fillCircle(16,16,14),t.fillStyle(6636321,1),t.fillRect(4,14,24,4),t.generateTexture("barrel",32,32),t.clear(),t.lineStyle(4,16739179,1),t.strokeCircle(16,16,12),t.generateTexture("ring",32,32),t.clear(),t.fillStyle(16729344,1),t.fillCircle(16,16,14),t.fillStyle(16737095,1),t.fillCircle(16,16,8),t.generateTexture("bumper",32,32),t.clear(),t.fillStyle(16766720,1),t.beginPath();for(let e=0;e<5;e++){const i=e*2*Math.PI/5-Math.PI/2,s=i+Math.PI/5;t.lineTo(16+Math.cos(i)*14,16+Math.sin(i)*14),t.lineTo(16+Math.cos(s)*7,16+Math.sin(s)*7)}t.closePath(),t.fillPath(),t.generateTexture("powerup_speed",32,32),t.clear(),t.fillStyle(5227511,1),t.fillCircle(16,16,14),t.fillStyle(11789820,.5),t.fillCircle(16,16,10),t.generateTexture("powerup_shield",32,32),t.clear(),t.fillStyle(7798531,1),t.fillTriangle(16,2,2,30,30,30),t.generateTexture("powerup_jump",32,32),t.clear(),t.fillStyle(30646,1),t.fillRoundedRect(0,0,256,128,20),t.fillStyle(46296,.7),t.fillRoundedRect(10,10,236,108,15),t.generateTexture("pool",256,128),t.clear(),t.fillStyle(11397364,1),t.fillCircle(4,4,4),t.generateTexture("splash_particle",8,8),t.clear(),t.fillStyle(16777215,.6),t.fillRect(0,0,2,16),t.generateTexture("speed_line",2,16),t.clear(),t.fillStyle(16739179,1),t.fillRect(0,0,6,6),t.generateTexture("confetti",6,6),t.clear(),t.fillStyle(30646,1),t.fillRoundedRect(0,0,80,80,15),t.fillStyle(46296,1),t.fillRoundedRect(4,4,72,72,12),t.generateTexture("btn_base",80,80),t.clear(),t.fillStyle(16777215,1),t.fillTriangle(50,10,50,60,15,35),t.generateTexture("arrow_left",64,64),t.clear(),t.fillStyle(16777215,1),t.fillTriangle(14,10,14,60,49,35),t.generateTexture("arrow_right",64,64),t.clear(),t.fillStyle(16777215,1),t.fillTriangle(32,8,8,56,56,56),t.generateTexture("jump_icon",64,64),t.clear(),t.fillStyle(8900331,1),t.fillRect(0,0,390,256),t.fillStyle(16777215,.4),t.fillEllipse(80,60,60,20),t.fillEllipse(200,40,80,25),t.fillEllipse(300,80,50,15),t.generateTexture("bg_sky",390,256),t.clear(),t.fillStyle(2976335,1),t.fillTriangle(0,200,100,50,200,200),t.fillTriangle(120,200,250,30,390,200),t.fillStyle(4231532,1),t.fillTriangle(50,200,180,80,320,200),t.generateTexture("bg_mountains",390,200),t.clear(),t.fillStyle(38599,1),t.fillRect(0,0,16,64),t.fillStyle(4770532,1),t.fillRect(4,0,8,64),t.generateTexture("side_rail",16,64),t.clear(),t.lineStyle(3,5227511,.7),t.strokeCircle(20,20,18),t.generateTexture("shield_effect",40,40),t.clear(),t.fillStyle(0,.5),t.fillRoundedRect(0,0,60,120,5),t.generateTexture("minimap_bg",60,120),t.destroy()}generatePlayerTextures(t){[16739179,5164484,16770669,9822675,15958401,11179738,16564041,3065014].forEach((i,s)=>{t.clear(),t.fillStyle(i,1),t.fillCircle(20,16,12),t.fillStyle(i,.8),t.fillEllipse(20,32,20,12),t.fillStyle(16777215,.9),t.fillEllipse(20,36,28,8),t.lineStyle(2,i,1),t.strokeEllipse(20,36,28,8),t.fillStyle(0,1),t.fillCircle(16,14,2),t.fillCircle(24,14,2),t.lineStyle(1,0,1),t.beginPath(),t.arc(20,18,4,0,Math.PI,!1),t.strokePath(),t.generateTexture(`player_${s}`,40,48)})}}const w={masterVolume:.8,musicVolume:.6,sfxVolume:.8,muted:!1,controlScheme:"buttons",quality:"medium",botCount:7,matchLength:45,tiltEnabled:!1},E={totalRuns:0,totalWins:0,bestTime:999999,totalScore:0,achievements:[],unlockedSkins:[0]},v=[16739179,5164484,16770669,9822675,15958401,11179738,16564041,3065014],S={STATS:"aquapark_stats",SETTINGS:"aquapark_settings",REPLAYS_INDEX:"aquapark_replays_index",REPLAY_PREFIX:"aquapark_replay_"};class y{static async saveStats(t){try{localStorage.setItem(S.STATS,JSON.stringify(t))}catch{}}static async loadStats(){try{const t=localStorage.getItem(S.STATS);if(t)return{...E,...JSON.parse(t)}}catch{}return{...E}}static async saveSettings(t){try{localStorage.setItem(S.SETTINGS,JSON.stringify(t))}catch{}}static async loadSettings(){try{const t=localStorage.getItem(S.SETTINGS);if(t)return{...w,...JSON.parse(t)}}catch{}return{...w}}static async saveReplay(t,e){try{localStorage.setItem(S.REPLAY_PREFIX+t,JSON.stringify(e));const i=await this.listReplays(),s={id:t,date:Date.now(),mode:e.mode,score:0,position:0,duration:e.frames.length/60};i.unshift(s),i.length>20&&i.splice(20).forEach(n=>{try{localStorage.removeItem(S.REPLAY_PREFIX+n.id)}catch{}}),localStorage.setItem(S.REPLAYS_INDEX,JSON.stringify(i))}catch{}}static async loadReplay(t){try{const e=localStorage.getItem(S.REPLAY_PREFIX+t);if(e)return JSON.parse(e)}catch{}return null}static async listReplays(){try{const t=localStorage.getItem(S.REPLAYS_INDEX);if(t)return JSON.parse(t)}catch{}return[]}static async deleteReplay(t){try{localStorage.removeItem(S.REPLAY_PREFIX+t);const i=(await this.listReplays()).filter(s=>s.id!==t);localStorage.setItem(S.REPLAYS_INDEX,JSON.stringify(i))}catch{}}static async clearAll(){try{const t=[];for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);i&&i.startsWith("aquapark_")&&t.push(i)}t.forEach(e=>localStorage.removeItem(e))}catch{}}static async getStorageUsage(){try{let t=0;for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);if(i&&i.startsWith("aquapark_")){const s=localStorage.getItem(i);s&&(t+=s.length*2)}}return t}catch{return 0}}}class C extends f.Scene{constructor(){super({key:"MenuScene"})}async create(){this.settings=await y.loadSettings();const{width:t,height:e}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(30646,30646,46296,9494767,1),i.fillRect(0,0,t,e),this.createWaterAnimation(t,e);const s={fontSize:"48px",fontFamily:"Arial, sans-serif",color:"#ffffff",stroke:"#0077B6",strokeThickness:6,shadow:{offsetX:3,offsetY:3,color:"#003566",blur:8,fill:!0}},a=this.add.text(t/2,80,"AQUA PARK",s).setOrigin(.5);this.tweens.add({targets:a,y:90,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.add.text(t/2,130,"Water Slide Racing",{fontSize:"18px",fontFamily:"Arial, sans-serif",color:"#CAF0F8"}).setOrigin(.5),[{label:"Classic Race",mode:"classic",y:240},{label:"Time Trial",mode:"timeTrial",y:320},{label:"Chaos Mode",mode:"chaos",y:400},{label:"Custom Game",mode:"custom",y:480}].forEach(({label:l,mode:c,y:d})=>{this.createMenuButton(t/2,d,l,()=>{this.scene.start("GameScene",{mode:c,settings:this.settings})})}),this.createSmallButton(t/2-80,600,"Settings",()=>{this.scene.start("SettingsScene")}),this.createSmallButton(t/2+80,600,"Replays",()=>{this.scene.start("ReplayScene",{action:"list"})});const r=await y.loadStats();this.add.text(t/2,700,`Races: ${r.totalRuns}  Wins: ${r.totalWins}`,{fontSize:"14px",fontFamily:"Arial, sans-serif",color:"#CAF0F8"}).setOrigin(.5),this.add.text(t/2,e-20,"v1.0.0",{fontSize:"10px",color:"#CAF0F8",fontFamily:"Arial, sans-serif"}).setOrigin(.5)}createMenuButton(t,e,i,s){const a=this.add.graphics();a.fillStyle(30646,.9),a.fillRoundedRect(t-120,e-25,240,50,15),a.lineStyle(2,13299960,1),a.strokeRoundedRect(t-120,e-25,240,50,15);const n=this.add.text(t,e,i,{fontSize:"22px",fontFamily:"Arial, sans-serif",color:"#ffffff"}).setOrigin(.5),r=this.add.zone(t,e,240,50).setInteractive();r.on("pointerdown",()=>{this.tweens.add({targets:[a,n],scaleX:.95,scaleY:.95,duration:100,yoyo:!0,onComplete:s})}),r.on("pointerover",()=>{a.clear(),a.fillStyle(38599,.95),a.fillRoundedRect(t-120,e-25,240,50,15),a.lineStyle(2,16777215,1),a.strokeRoundedRect(t-120,e-25,240,50,15)}),r.on("pointerout",()=>{a.clear(),a.fillStyle(30646,.9),a.fillRoundedRect(t-120,e-25,240,50,15),a.lineStyle(2,13299960,1),a.strokeRoundedRect(t-120,e-25,240,50,15)})}createSmallButton(t,e,i,s){const a=this.add.graphics();a.fillStyle(13670,.8),a.fillRoundedRect(t-65,e-20,130,40,10),this.add.text(t,e,i,{fontSize:"16px",fontFamily:"Arial, sans-serif",color:"#CAF0F8"}).setOrigin(.5),this.add.zone(t,e,130,40).setInteractive().on("pointerdown",s)}createWaterAnimation(t,e){const i=e-100;for(let s=0;s<3;s++){const a=this.add.graphics();a.fillStyle(9494767,.3+s*.15),a.fillEllipse(t/2,i+s*20,t+40,80),this.tweens.add({targets:a,x:10+s*5,duration:2e3+s*500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}}const h={FIXED_DT:1/60,LANE_WIDTH:50,FORWARD_ACCEL:120,MAX_FORWARD_SPEED:400,LATERAL_SPEED:200,LATERAL_ACCEL:800,LATERAL_FRICTION:600,JUMP_DURATION:.5,STUN_DURATION:.4,COLLISION_PUSH:150,COLLISION_RADIUS:20,SPEED_BOOST_MULT:1.5,SPEED_BOOST_DURATION:3,SHIELD_DURATION:4,JUMP_BOOST_MULT:1.5,JUMP_BOOST_DURATION:5,LANDING_BOOST:30,SLIDE_WIDTH:250};class L{constructor(t){this.seed=t}next(){return this.seed=this.seed*1664525+1013904223&4294967295,(this.seed>>>0)/4294967295}nextInt(t,e){return Math.floor(this.next()*(e-t))+t}nextFloat(t,e){return this.next()*(e-t)+t}getSeed(){return this.seed}}function b(o,t,e,i,s,a){return{id:o,name:t,x:e*h.LANE_WIDTH+h.LANE_WIDTH/2,y:0,lane:e,forwardSpeed:0,lateralSpeed:0,distanceTraveled:0,isJumping:!1,jumpTimer:0,stunTimer:0,hasShield:!1,shieldTimer:0,speedBoostTimer:0,jumpBoostTimer:0,isBot:i,botProfile:a,skinIndex:s,score:0,finished:!1,finishTime:0,finishPosition:0}}function O(o,t,e,i){if(o.finished||(o.stunTimer>0&&(o.stunTimer-=i,o.stunTimer<0&&(o.stunTimer=0)),o.shieldTimer>0&&(o.shieldTimer-=i,o.shieldTimer<=0&&(o.hasShield=!1,o.shieldTimer=0)),o.speedBoostTimer>0&&(o.speedBoostTimer-=i,o.speedBoostTimer<0&&(o.speedBoostTimer=0)),o.jumpBoostTimer>0&&(o.jumpBoostTimer-=i,o.jumpBoostTimer<0&&(o.jumpBoostTimer=0)),o.stunTimer>0))return;const s=-e.slope*50,a=o.speedBoostTimer>0?h.SPEED_BOOST_MULT:1;o.forwardSpeed+=(h.FORWARD_ACCEL+s)*i,o.forwardSpeed=Math.min(o.forwardSpeed*a,h.MAX_FORWARD_SPEED),o.forwardSpeed*=e.friction;const n=(t.left?-1:0)+(t.right?1:0);n!==0?(o.lateralSpeed+=n*h.LATERAL_ACCEL*i,o.lateralSpeed=Math.max(-200,Math.min(h.LATERAL_SPEED,o.lateralSpeed))):o.lateralSpeed>0?(o.lateralSpeed-=h.LATERAL_FRICTION*i,o.lateralSpeed<0&&(o.lateralSpeed=0)):o.lateralSpeed<0&&(o.lateralSpeed+=h.LATERAL_FRICTION*i,o.lateralSpeed>0&&(o.lateralSpeed=0)),t.jump&&!o.isJumping&&(o.isJumping=!0,o.jumpTimer=o.jumpBoostTimer>0?h.JUMP_DURATION*h.JUMP_BOOST_MULT:h.JUMP_DURATION),o.isJumping&&(o.jumpTimer-=i,o.jumpTimer<=0&&(o.isJumping=!1,o.jumpTimer=0,o.forwardSpeed+=h.LANDING_BOOST)),o.x+=o.lateralSpeed*i,o.distanceTraveled+=o.forwardSpeed*i;const r=e.lanes*h.LANE_WIDTH/2,l=h.SLIDE_WIDTH/2;o.x=Math.max(l-r+10,Math.min(l+r-10,o.x)),o.lane=Math.floor(o.x/h.LANE_WIDTH),o.lane=Math.max(0,Math.min(e.lanes-1,o.lane))}function B(o,t){if(o.isJumping||t.isJumping||o.finished||t.finished)return!1;const e=o.x-t.x,i=o.distanceTraveled-t.distanceTraveled;return Math.sqrt(e*e+i*i)<h.COLLISION_RADIUS*2}function M(o,t){if(o.hasShield&&t.hasShield)return;const i=o.x-t.x>0?1:-1;o.hasShield||(o.lateralSpeed+=i*h.COLLISION_PUSH,o.stunTimer=h.STUN_DURATION),t.hasShield||(t.lateralSpeed-=i*h.COLLISION_PUSH,t.stunTimer=h.STUN_DURATION)}function P(o,t){if(!o.hasShield)switch(t){case"barrel":o.forwardSpeed*=.5,o.stunTimer=h.STUN_DURATION*1.5;break;case"ring":o.forwardSpeed*=.7,o.lateralSpeed*=-.5;break;case"bumper":o.lateralSpeed+=(o.x>h.SLIDE_WIDTH/2?1:-1)*h.COLLISION_PUSH*1.5,o.stunTimer=h.STUN_DURATION;break}}function N(o,t){switch(t){case"speed_boost":o.speedBoostTimer=h.SPEED_BOOST_DURATION;break;case"shield":o.hasShield=!0,o.shieldTimer=h.SHIELD_DURATION;break;case"jump_boost":o.jumpBoostTimer=h.JUMP_BOOST_DURATION;break}}function k(o,t,e,i){const s=Math.max(0,(t-o+1)*100),a=Math.max(0,Math.floor((i-e)*10));return s+a}const j={casual:{type:"casual",name:"Casual",targetSpeedFactor:.7,boostSeekRange:100,optimalLineWeight:.3,collisionAggression:.1,collisionAvoidance:.7,jumpFrequency:.2,jumpTimingPrecision:.3,riskTolerance:.2,obstacleAvoidRange:120,steeringJitter:.15,reactionDelay:8,mistakeChance:.1,adaptiveness:.1},aggressive:{type:"aggressive",name:"Aggressive",targetSpeedFactor:.85,boostSeekRange:150,optimalLineWeight:.4,collisionAggression:.8,collisionAvoidance:.2,jumpFrequency:.4,jumpTimingPrecision:.5,riskTolerance:.8,obstacleAvoidRange:80,steeringJitter:.1,reactionDelay:4,mistakeChance:.08,adaptiveness:.3},speedster:{type:"speedster",name:"Speedster",targetSpeedFactor:.95,boostSeekRange:200,optimalLineWeight:.8,collisionAggression:.2,collisionAvoidance:.5,jumpFrequency:.3,jumpTimingPrecision:.8,riskTolerance:.5,obstacleAvoidRange:150,steeringJitter:.05,reactionDelay:2,mistakeChance:.04,adaptiveness:.2},trickster:{type:"trickster",name:"Trickster",targetSpeedFactor:.75,boostSeekRange:120,optimalLineWeight:.3,collisionAggression:.3,collisionAvoidance:.3,jumpFrequency:.8,jumpTimingPrecision:.7,riskTolerance:.7,obstacleAvoidRange:100,steeringJitter:.12,reactionDelay:5,mistakeChance:.06,adaptiveness:.2},adaptive:{type:"adaptive",name:"Adaptive",targetSpeedFactor:.8,boostSeekRange:160,optimalLineWeight:.6,collisionAggression:.4,collisionAvoidance:.4,jumpFrequency:.4,jumpTimingPrecision:.6,riskTolerance:.5,obstacleAvoidRange:130,steeringJitter:.08,reactionDelay:3,mistakeChance:.05,adaptiveness:.9}};class W{constructor(t,e){this.state="race",this.stateTimer=0,this.reactionBuffer=[],this.targetLane=2,this.frameCount=0,this.profile=j[t];for(let i=0;i<this.profile.reactionDelay;i++)this.reactionBuffer.push({left:!1,right:!1,jump:!1})}update(t,e,i,s){this.frameCount++,this.stateTimer++,this.updateState(t,e,i,s);const a=this.generateInput(t,e,i,s);this.reactionBuffer.push(a);const n=this.reactionBuffer.shift();return s.next()<this.profile.steeringJitter&&(s.next()>.5?n.left=!n.left:n.right=!n.right),s.next()<this.profile.mistakeChance/60&&(n.left=s.next()>.5,n.right=!n.left),n}updateState(t,e,i,s){if(t.stunTimer>0){this.state="recover",this.stateTimer=0;return}const a=e.filter(n=>n.id!==t.id&&!n.finished&&Math.abs(n.distanceTraveled-t.distanceTraveled)<100&&Math.abs(n.x-t.x)<h.SLIDE_WIDTH);if(this.profile.adaptiveness>.5){const n=e.find(r=>!r.isBot);n&&n.distanceTraveled>t.distanceTraveled+100&&(this.profile.targetSpeedFactor=Math.min(1,this.profile.targetSpeedFactor+.1),this.profile.riskTolerance=Math.min(1,this.profile.riskTolerance+.1))}this.state==="recover"&&t.stunTimer<=0&&(this.state="race",this.stateTimer=0),a.length>0&&this.profile.collisionAggression>s.next()?(this.state="chase",this.stateTimer=0):this.state==="chase"&&(a.length===0||this.stateTimer>120)&&(this.state="race",this.stateTimer=0),(t.speedBoostTimer>0||t.hasShield||t.jumpBoostTimer>0)&&s.next()<.1&&(this.state="usePowerup",this.stateTimer=0),this.stateTimer>180&&(this.state="race",this.stateTimer=0)}generateInput(t,e,i,s){const a={left:!1,right:!1,jump:!1};switch(this.state){case"race":return this.raceInput(t,i,s);case"avoidObstacle":return this.avoidObstacleInput(t,i,s);case"chase":return this.chaseInput(t,e,s);case"usePowerup":return this.powerupInput(t,s);case"recover":return a}}raceInput(t,e,i){const s={left:!1,right:!1,jump:!1};this.targetLane=this.scoreLanes(t,e,i);const n=this.targetLane*h.LANE_WIDTH+h.LANE_WIDTH/2-t.x,r=10;return n<-r?s.left=!0:n>r&&(s.right=!0),(e.type==="ramp"&&i.next()<this.profile.jumpTimingPrecision||i.next()<this.profile.jumpFrequency/120)&&(s.jump=!0),s}avoidObstacleInput(t,e,i){const s={left:!1,right:!1,jump:!1},r=this.findSafestLane(t,e)*h.LANE_WIDTH+h.LANE_WIDTH/2-t.x;return r<-5?s.left=!0:r>5&&(s.right=!0),i.next()<this.profile.riskTolerance*.5&&(s.jump=!0),s}chaseInput(t,e,i){const s={left:!1,right:!1,jump:!1},a=e.filter(n=>n.id!==t.id&&!n.finished).sort((n,r)=>{const l=Math.abs(n.distanceTraveled-t.distanceTraveled)+Math.abs(n.x-t.x),c=Math.abs(r.distanceTraveled-t.distanceTraveled)+Math.abs(r.x-t.x);return l-c});if(a.length>0){const r=a[0].x-t.x;this.profile.collisionAggression>.5?r<-5?s.left=!0:r>5&&(s.right=!0):r<-5?s.right=!0:r>5&&(s.left=!0)}return i.next()<.02&&(s.jump=!0),s}powerupInput(t,e){const i={left:!1,right:!1,jump:!1};if(t.jumpBoostTimer>0&&e.next()<.05&&(i.jump=!0),t.speedBoostTimer>0){const s=h.SLIDE_WIDTH/2;t.x<s-10?i.right=!0:t.x>s+10&&(i.left=!0)}return i}scoreLanes(t,e,i){const s=e.lanes,a=[];for(let l=0;l<s;l++){let c=0;const d=Math.abs(l-Math.floor(s/2));c+=(s-d)*this.profile.optimalLineWeight*10,e.obstacles.forEach(u=>{u.lane===l&&(c-=20*this.profile.collisionAvoidance)}),e.powerups.forEach(u=>{u.lane===l&&(c+=15*this.profile.boostSeekRange/200)}),c+=i.nextFloat(-5,5),a.push(c)}let n=0,r=-1/0;return a.forEach((l,c)=>{l>r&&(r=l,n=c)}),n}findSafestLane(t,e){const i=e.lanes,s=new Array(i).fill(0);e.obstacles.forEach(r=>{r.lane>=0&&r.lane<i&&(s[r.lane]+=10)});let a=t.lane,n=1/0;return s.forEach((r,l)=>{r<n&&(n=r,a=l)}),a}getState(){return this.state}getProfile(){return{...this.profile}}}function U(){return[m("straight",400,5,.98,-.5,[{type:"barrel",lane:1,position:.5},{type:"barrel",lane:3,position:.7}],[{type:"speed_boost",lane:2,position:.3}]),m("curve_left",300,5,.97,-.6,[{type:"ring",lane:0,position:.4},{type:"bumper",lane:4,position:.6,moving:!0,moveRange:30}],[]),m("ramp",200,5,.99,-1,[],[{type:"jump_boost",lane:2,position:.5}]),m("straight",500,5,.98,-.4,[{type:"barrel",lane:0,position:.2},{type:"barrel",lane:2,position:.3},{type:"barrel",lane:4,position:.4},{type:"bumper",lane:1,position:.6,moving:!0,moveRange:40},{type:"ring",lane:3,position:.8}],[{type:"speed_boost",lane:1,position:.15},{type:"shield",lane:3,position:.5}]),m("narrow",200,3,.96,-.7,[{type:"bumper",lane:1,position:.5,moving:!0,moveRange:20}],[{type:"speed_boost",lane:0,position:.3}]),m("curve_right",350,5,.97,-.5,[{type:"ring",lane:2,position:.3},{type:"barrel",lane:4,position:.5},{type:"barrel",lane:0,position:.7}],[{type:"jump_boost",lane:2,position:.6}]),m("ramp",250,5,.99,-1.2,[],[{type:"speed_boost",lane:2,position:.4}]),m("gap",150,5,.95,-.3,[{type:"ring",lane:1,position:.5},{type:"ring",lane:3,position:.5}],[]),m("straight",600,5,.98,-.8,[{type:"bumper",lane:0,position:.2,moving:!0,moveRange:50},{type:"bumper",lane:4,position:.3,moving:!0,moveRange:50},{type:"barrel",lane:2,position:.5},{type:"ring",lane:1,position:.7},{type:"ring",lane:3,position:.7},{type:"barrel",lane:2,position:.85}],[{type:"speed_boost",lane:2,position:.1},{type:"shield",lane:0,position:.6},{type:"speed_boost",lane:4,position:.9}]),m("splitter",300,5,.97,-.6,[{type:"bumper",lane:2,position:.4}],[{type:"speed_boost",lane:0,position:.5},{type:"speed_boost",lane:4,position:.5}]),m("straight",400,5,.99,-1,[{type:"barrel",lane:1,position:.3},{type:"barrel",lane:3,position:.3}],[{type:"speed_boost",lane:2,position:.5}])]}function Y(o,t,e){const i=[],s=e.matchLength*80;let a=0;const n=["straight","curve_left","curve_right","ramp","narrow","gap"];t==="chaos"&&n.push("splitter","gap","ramp");const r=m("straight",300,5,.98,-.5,[],[{type:"speed_boost",lane:2,position:.5}]);for(i.push(r),a+=300;a<s;){const l=n[o.nextInt(0,n.length)],c=o.nextInt(150,500),d=l==="narrow"?3:5,u=o.nextFloat(.95,.99),p=o.nextFloat(-1.2,-.3),g=[],T=t==="chaos"?o.nextInt(2,6):o.nextInt(0,4),F=["barrel","ring","bumper"];for(let R=0;R<T;R++)g.push({type:F[o.nextInt(0,F.length)],lane:o.nextInt(0,d),position:o.nextFloat(.1,.9),moving:t==="chaos"?o.next()>.5:o.next()>.8,moveRange:o.nextInt(20,50)});const A=[],D=o.nextInt(0,3),I=["speed_boost","shield","jump_boost"];for(let R=0;R<D;R++)A.push({type:I[o.nextInt(0,I.length)],lane:o.nextInt(0,d),position:o.nextFloat(.1,.9)});i.push(m(l,c,d,u,p,g,A)),a+=c}return i.push(m("straight",200,5,.99,-.8,[],[])),i}function m(o,t,e,i,s,a,n){return{type:o,length:t,lanes:e,friction:i,slope:s,obstacles:a,powerups:n}}class z{constructor(t,e){this.scene=t,this.player=e,this.create()}create(){const{width:t}=this.scene.cameras.main;this.container=this.scene.add.container(0,0).setScrollFactor(0).setDepth(900);const e=this.scene.add.graphics();e.fillStyle(0,.4),e.fillRect(0,0,t,50),this.container.add(e),this.positionText=this.scene.add.text(15,12,"#-",{fontSize:"22px",fontFamily:"Arial",color:"#FFD700",fontStyle:"bold"}),this.container.add(this.positionText),this.timeText=this.scene.add.text(t/2,12,"0:00",{fontSize:"18px",fontFamily:"Arial",color:"#FFFFFF"}).setOrigin(.5,0),this.container.add(this.timeText),this.speedText=this.scene.add.text(t-15,12,"0",{fontSize:"16px",fontFamily:"Arial",color:"#90E0EF"}).setOrigin(1,0),this.container.add(this.speedText),this.progressBar=this.scene.add.graphics(),this.container.add(this.progressBar)}update(t,e,i){const{width:s}=this.scene.cameras.main;this.positionText.setText(`#${this.player.finishPosition||"-"}`);const a=Math.floor(t/60),n=Math.floor(t%60);this.timeText.setText(`${a}:${n.toString().padStart(2,"0")}`);const r=Math.floor(this.player.forwardSpeed);this.speedText.setText(`${r} km/h`);const l=Math.min(1,this.player.distanceTraveled/i);this.progressBar.clear(),this.progressBar.fillStyle(13670,.8),this.progressBar.fillRect(0,0,s,4),this.progressBar.fillStyle(46296,1),this.progressBar.fillRect(0,0,s*l,4),this.player.speedBoostTimer>0?this.speedText.setColor("#FFD700"):this.player.hasShield?this.speedText.setColor("#4FC3F7"):this.speedText.setColor("#90E0EF")}destroy(){this.container.destroy()}}class V{constructor(t,e,i){this.input={left:!1,right:!1,jump:!1},this.swipeStartX=0,this.swipeStartY=0,this.swipeThreshold=30,this.swipeDeadzone=10,this.tiltBaseline=0,this.tiltSensitivity=15,this.scene=t,this.scheme=e,this.tiltEnabled=i,this.setupKeyboard(),e==="buttons"?this.setupButtons():e==="swipe"&&this.setupSwipe(),i&&this.setupTilt()}getInput(){var t,e;return this.cursors&&(this.cursors.left.isDown&&(this.input.left=!0),this.cursors.right.isDown&&(this.input.right=!0),this.cursors.left.isUp&&this.scheme!=="tilt"&&this.scheme!=="buttons"&&(this.input.left=!1),this.cursors.right.isUp&&this.scheme!=="tilt"&&this.scheme!=="buttons"&&(this.input.right=!1)),(t=this.spaceKey)!=null&&t.isDown&&(this.input.jump=!0),(e=this.spaceKey)!=null&&e.isUp&&this.scheme!=="buttons"&&(this.input.jump=!1),{...this.input}}setupKeyboard(){this.scene.input.keyboard&&(this.cursors=this.scene.input.keyboard.createCursorKeys(),this.spaceKey=this.scene.input.keyboard.addKey(f.Input.Keyboard.KeyCodes.SPACE))}setupButtons(){const{width:t,height:e}=this.scene.cameras.main,i=70,s=20,a=e-s-i/2;this.leftBtn=this.createButton(s+i/2,a,i,"arrow_left"),this.leftBtn.setScrollFactor(0).setDepth(950);const n=this.scene.add.zone(s+i/2,a,i,i).setInteractive().setScrollFactor(0).setDepth(951);n.on("pointerdown",()=>{this.input.left=!0}),n.on("pointerup",()=>{this.input.left=!1}),n.on("pointerout",()=>{this.input.left=!1}),this.rightBtn=this.createButton(s+i*1.8,a,i,"arrow_right"),this.rightBtn.setScrollFactor(0).setDepth(950);const r=this.scene.add.zone(s+i*1.8,a,i,i).setInteractive().setScrollFactor(0).setDepth(951);r.on("pointerdown",()=>{this.input.right=!0}),r.on("pointerup",()=>{this.input.right=!1}),r.on("pointerout",()=>{this.input.right=!1}),this.jumpBtn=this.createButton(t-s-i/2,a,i,"jump_icon"),this.jumpBtn.setScrollFactor(0).setDepth(950);const l=this.scene.add.zone(t-s-i/2,a,i,i).setInteractive().setScrollFactor(0).setDepth(951);l.on("pointerdown",()=>{this.input.jump=!0}),l.on("pointerup",()=>{this.input.jump=!1}),l.on("pointerout",()=>{this.input.jump=!1})}createButton(t,e,i,s){const a=this.scene.add.container(t,e),n=this.scene.add.graphics();n.fillStyle(30646,.6),n.fillRoundedRect(-i/2,-i/2,i,i,15),n.lineStyle(2,13299960,.5),n.strokeRoundedRect(-i/2,-i/2,i,i,15),a.add(n);const r=this.scene.add.sprite(0,0,s);return r.setDisplaySize(i*.5,i*.5),a.add(r),a}setupSwipe(){this.scene.input.on("pointerdown",a=>{this.swipeStartX=a.x,this.swipeStartY=a.y}),this.scene.input.on("pointermove",a=>{if(!a.isDown)return;const n=a.x-this.swipeStartX,r=a.y-this.swipeStartY;Math.abs(n)>this.swipeDeadzone?(this.input.left=n<-this.swipeThreshold,this.input.right=n>this.swipeThreshold):(this.input.left=!1,this.input.right=!1),r<-this.swipeThreshold*1.5&&(this.input.jump=!0)}),this.scene.input.on("pointerup",()=>{this.input.left=!1,this.input.right=!1,this.input.jump=!1});const{width:t,height:e}=this.scene.cameras.main;this.createButton(t-50,e-60,60,"jump_icon").setScrollFactor(0).setDepth(950);const s=this.scene.add.zone(t-50,e-60,60,60).setInteractive().setScrollFactor(0).setDepth(951);s.on("pointerdown",()=>{this.input.jump=!0}),s.on("pointerup",()=>{this.input.jump=!1})}setupTilt(){if("DeviceOrientationEvent"in window){const t=DeviceOrientationEvent.requestPermission;typeof t=="function"?t().then(e=>{e==="granted"&&this.addTiltListener()}).catch(()=>{}):this.addTiltListener()}}addTiltListener(){let t=!1;window.addEventListener("deviceorientation",e=>{if(e.gamma===null)return;t||(this.tiltBaseline=e.gamma,t=!0);const i=e.gamma-this.tiltBaseline;i<-this.tiltSensitivity?(this.input.left=!0,this.input.right=!1):i>this.tiltSensitivity?(this.input.left=!1,this.input.right=!0):(this.input.left=!1,this.input.right=!1)})}destroy(){var t,e,i;(t=this.leftBtn)==null||t.destroy(),(e=this.rightBtn)==null||e.destroy(),(i=this.jumpBtn)==null||i.destroy()}}class x{constructor(){this.audioContext=null,this.settings=null,this.musicOscillator=null,this.musicGain=null,this.isMusicPlaying=!1}static getInstance(){return x.instance||(x.instance=new x),x.instance}getContext(){if(!this.audioContext)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch{return null}return this.audioContext}applySettings(t){if(this.settings=t,this.musicGain&&this.audioContext){const e=t.muted?0:t.masterVolume*t.musicVolume;this.musicGain.gain.setValueAtTime(e*.1,this.audioContext.currentTime)}}playMusic(){var e;if(this.isMusicPlaying)return;const t=this.getContext();if(!(!t||(e=this.settings)!=null&&e.muted))try{this.musicGain=t.createGain();const i=this.settings?this.settings.masterVolume*this.settings.musicVolume:.3;this.musicGain.gain.setValueAtTime(i*.1,t.currentTime),this.musicGain.connect(t.destination),this.musicOscillator=t.createOscillator(),this.musicOscillator.type="sine",this.musicOscillator.frequency.setValueAtTime(440,t.currentTime);const s=[440,494,523,587,659,587,523,494],a=.3;s.forEach((r,l)=>{const c=t.currentTime+l*a;this.musicOscillator.frequency.setValueAtTime(r,c)});const n=s.length*a;this.musicOscillator.connect(this.musicGain),this.musicOscillator.start(),this.scheduleLoop(t,s,a,n),this.isMusicPlaying=!0}catch{}}scheduleLoop(t,e,i,s){const a=()=>{!this.isMusicPlaying||!this.musicOscillator||(e.forEach((n,r)=>{const l=t.currentTime+r*i;try{this.musicOscillator.frequency.setValueAtTime(n,l)}catch{}}),setTimeout(a,s*1e3))};setTimeout(a,s*1e3)}stopMusic(){if(this.musicOscillator){try{this.musicOscillator.stop()}catch{}this.musicOscillator=null}this.isMusicPlaying=!1}playSfx(t){var s;const e=this.getContext();if(!e||(s=this.settings)!=null&&s.muted)return;const i=this.settings?this.settings.masterVolume*this.settings.sfxVolume:.5;if(!(i<=0))try{const a=e.createOscillator(),n=e.createGain();switch(n.gain.setValueAtTime(i*.2,e.currentTime),n.connect(e.destination),a.connect(n),t){case"jump":a.type="sine",a.frequency.setValueAtTime(600,e.currentTime),a.frequency.exponentialRampToValueAtTime(1200,e.currentTime+.15),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.2),a.start(),a.stop(e.currentTime+.2);break;case"collision":a.type="sawtooth",a.frequency.setValueAtTime(200,e.currentTime),a.frequency.exponentialRampToValueAtTime(80,e.currentTime+.15),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.2),a.start(),a.stop(e.currentTime+.2);break;case"splash":a.type="sine",a.frequency.setValueAtTime(800,e.currentTime),a.frequency.exponentialRampToValueAtTime(200,e.currentTime+.4),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.5),a.start(),a.stop(e.currentTime+.5);break;case"powerup":a.type="sine",a.frequency.setValueAtTime(523,e.currentTime),a.frequency.setValueAtTime(659,e.currentTime+.1),a.frequency.setValueAtTime(784,e.currentTime+.2),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.3),a.start(),a.stop(e.currentTime+.3);break;case"win":a.type="sine",[523,659,784,1047].forEach((l,c)=>{a.frequency.setValueAtTime(l,e.currentTime+c*.15)}),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.8),a.start(),a.stop(e.currentTime+.8);break;case"click":a.type="sine",a.frequency.setValueAtTime(800,e.currentTime),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.05),a.start(),a.stop(e.currentTime+.05);break}}catch{}}}class G extends f.Scene{constructor(){super({key:"GameScene"}),this.players=[],this.track=[],this.totalTrackLength=0,this.elapsedTime=0,this.tickCount=0,this.gameOver=!1,this.finishCount=0,this.countdownTimer=3,this.isCountingDown=!0,this.playerInput={left:!1,right:!1,jump:!1},this.botControllers=new Map,this.replayFrames=[],this.isReplay=!1,this.replayTick=0,this.playerSprites=new Map,this.obstacleSprites=[],this.powerupSprites=[],this.cameraTarget=0}init(t){this.mode=t.mode||"classic",this.settings=t.settings||w,this.isReplay=!!t.replay,this.replayData=t.replay,this.players=[],this.botControllers.clear(),this.playerSprites.clear(),this.obstacleSprites=[],this.powerupSprites=[],this.replayFrames=[],this.elapsedTime=0,this.tickCount=0,this.gameOver=!1,this.finishCount=0,this.replayTick=0,this.countdownTimer=3,this.isCountingDown=!0,this.playerInput={left:!1,right:!1,jump:!1}}create(){var i;const{width:t,height:e}=this.cameras.main;this.seed=this.isReplay&&this.replayData?this.replayData.seed:Date.now(),this.rng=new L(this.seed),this.mode==="classic"||this.isReplay&&((i=this.replayData)==null?void 0:i.mode)==="classic"?this.track=U():this.track=Y(this.rng,this.mode,this.settings),this.totalTrackLength=this.track.reduce((s,a)=>s+a.length,0),this.bgSky=this.add.tileSprite(0,0,t,256,"bg_sky").setOrigin(0,0).setScrollFactor(0),this.bgMountains=this.add.tileSprite(0,200,t,200,"bg_mountains").setOrigin(0,0).setScrollFactor(0),this.slideGraphics=this.add.graphics(),this.drawTrack(),this.createPlayers(),this.createTrackObjects(),this.players.forEach(s=>this.createPlayerSprite(s)),this.createParticleEffects(),this.hud=new z(this,this.players.find(s=>!s.isBot)),this.isReplay||(this.controls=new V(this,this.settings.controlScheme,this.settings.tiltEnabled)),this.audioManager=x.getInstance(),this.audioManager.applySettings(this.settings),this.cameras.main.setBackgroundColor(8900331),this.showCountdown()}update(t,e){if(this.isCountingDown||this.gameOver)return;const i=h.FIXED_DT;if(this.elapsedTime+=i,this.tickCount++,!this.isReplay)this.playerInput=this.controls.getInput(),this.replayFrames.push({tick:this.tickCount,inputs:{...this.playerInput}});else if(this.replayData){const r=this.replayData.frames[this.replayTick];r&&(this.playerInput=r.inputs,this.replayTick++)}const s=r=>{let l=0;for(const c of this.track)if(l+=c.length,r<l)return c;return this.track[this.track.length-1]},a=this.players.find(r=>!r.isBot),n=s(a.distanceTraveled);O(a,this.playerInput,n,i),this.players.filter(r=>r.isBot&&!r.finished).forEach(r=>{const l=this.botControllers.get(r.id);if(l){const c=l.update(r,this.players,s(r.distanceTraveled),this.rng);O(r,c,s(r.distanceTraveled),i)}});for(let r=0;r<this.players.length;r++)for(let l=r+1;l<this.players.length;l++)B(this.players[r],this.players[l])&&(M(this.players[r],this.players[l]),this.audioManager.playSfx("collision"),(!this.players[r].isBot||!this.players[l].isBot)&&this.cameras.main.shake(100,.005));if(this.checkTrackObjectCollisions(),this.players.forEach(r=>{!r.finished&&r.distanceTraveled>=this.totalTrackLength&&(this.finishCount++,r.finished=!0,r.finishTime=this.elapsedTime,r.finishPosition=this.finishCount,r.score=k(this.finishCount,this.players.length,this.elapsedTime,this.settings.matchLength),r.isBot||this.audioManager.playSfx("splash"))}),this.elapsedTime>=this.settings.matchLength||this.players.every(r=>r.finished)){this.players.forEach(r=>{r.finished||(this.finishCount++,r.finished=!0,r.finishTime=this.elapsedTime,r.finishPosition=this.finishCount,r.score=k(this.finishCount,this.players.length,this.elapsedTime,this.settings.matchLength))}),this.endGame();return}this.updateRendering(a),this.hud.update(this.elapsedTime,this.finishCount,this.totalTrackLength)}createPlayers(){var a;const t=this.settings.botCount,e=((a=this.track[0])==null?void 0:a.lanes)||5,i=b("player","You",Math.floor(e/2),!1,0);this.players.push(i);const s=["casual","aggressive","speedster","trickster","adaptive"];for(let n=0;n<t;n++){const r=n%e,l=s[n%s.length],c=b(`bot_${n}`,`Bot ${n+1}`,r,!0,(n+1)%8,l);this.players.push(c);const d=new W(l,this.rng);this.botControllers.set(c.id,d)}}createPlayerSprite(t){const e=this.add.container(t.x,0),i=this.add.sprite(0,0,`player_${t.skinIndex}`);i.setScale(.8),e.add(i);const s=this.add.text(0,-30,t.name,{fontSize:"10px",fontFamily:"Arial",color:t.isBot?"#FFFFFF":"#FFE66D",stroke:"#000000",strokeThickness:2}).setOrigin(.5);e.add(s),this.playerSprites.set(t.id,e)}drawTrack(){const t=this.slideGraphics;t.clear();let e=200;const i=this.cameras.main.width/2;this.track.forEach(s=>{const a=s.lanes*h.LANE_WIDTH;t.fillStyle(46296,1),t.fillRect(i-a/2,e,a,s.length),t.lineStyle(1,4770532,.3);for(let n=1;n<s.lanes;n++){const r=i-a/2+n*h.LANE_WIDTH;t.lineBetween(r,e,r,e+s.length)}t.fillStyle(38599,1),t.fillRect(i-a/2-8,e,8,s.length),t.fillRect(i+a/2,e,8,s.length),s.type==="ramp"?(t.fillStyle(16556817,.4),t.fillTriangle(i-a/4,e+s.length,i+a/4,e+s.length,i,e)):s.type==="narrow"&&(t.fillStyle(16739179,.2),t.fillRect(i-a/2,e,a,s.length)),e+=s.length}),t.fillStyle(30646,1),t.fillRoundedRect(i-100,e,200,80,20),t.fillStyle(46296,.7),t.fillRoundedRect(i-90,e+10,180,60,15),t.lineStyle(3,16766720,1),t.strokeRoundedRect(i-100,e,200,80,20),this.add.text(i,e+40,"FINISH",{fontSize:"24px",fontFamily:"Arial",color:"#FFD700",stroke:"#003566",strokeThickness:3}).setOrigin(.5)}createTrackObjects(){let t=200;const e=this.cameras.main.width/2;this.track.forEach(i=>{const s=i.lanes*h.LANE_WIDTH,a=e-s/2;i.obstacles.forEach(n=>{const r=a+n.lane*h.LANE_WIDTH+h.LANE_WIDTH/2,l=t+n.position*i.length,c=this.add.sprite(r,l,n.type);c.setData("type",n.type),c.setData("worldY",l),this.obstacleSprites.push(c),n.moving&&this.tweens.add({targets:c,x:r+(n.moveRange||30),duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}),i.powerups.forEach(n=>{const r=a+n.lane*h.LANE_WIDTH+h.LANE_WIDTH/2,l=t+n.position*i.length,c=`powerup_${n.type==="speed_boost"?"speed":n.type==="shield"?"shield":"jump"}`,d=this.add.sprite(r,l,c);d.setData("type",n.type),d.setData("worldY",l),d.setData("collected",!1),this.powerupSprites.push(d),this.tweens.add({targets:d,y:l-5,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}),t+=i.length})}checkTrackObjectCollisions(){const t=this.players.find(i=>!i.isBot);this.cameras.main.scrollY;const e=this.cameras.main.height;this.obstacleSprites.forEach(i=>{if(!i.visible)return;const s=i.getData("worldY");Math.abs(s-(t.distanceTraveled+200))>e||this.players.forEach(a=>{if(a.finished||a.isJumping)return;const n=200+a.distanceTraveled,r=Math.abs(n-s),l=Math.abs(a.x+this.cameras.main.width/2-this.track[0].lanes*h.LANE_WIDTH/2-i.x);r<20&&l<20&&(P(a,i.getData("type")),i.setVisible(!1),a.isBot||this.audioManager.playSfx("collision"))})}),this.powerupSprites.forEach(i=>{if(i.getData("collected"))return;const s=i.getData("worldY");Math.abs(s-(t.distanceTraveled+200))>e||this.players.forEach(a=>{if(a.finished||a.isJumping)return;const n=200+a.distanceTraveled,r=Math.abs(n-s),l=Math.abs(a.x+this.cameras.main.width/2-this.track[0].lanes*h.LANE_WIDTH/2-i.x);r<25&&l<25&&(N(a,i.getData("type")),i.setData("collected",!0),i.setVisible(!1),a.isBot||this.audioManager.playSfx("powerup"))})})}createParticleEffects(){this.splashEmitter=this.add.particles(0,0,"splash_particle",{speed:{min:20,max:80},angle:{min:240,max:300},lifespan:400,gravityY:200,scale:{start:.8,end:0},frequency:-1,quantity:5}),this.speedLineEmitter=this.add.particles(0,0,"speed_line",{speed:{min:100,max:200},angle:{min:85,max:95},lifespan:300,scale:{start:1,end:.2},alpha:{start:.5,end:0},frequency:-1,quantity:3})}updateRendering(t){var r;const{width:e,height:i}=this.cameras.main;this.cameraTarget=t.distanceTraveled;const s=this.cameraTarget-i*.6;this.cameras.main.scrollY=f.Math.Linear(this.cameras.main.scrollY,s,.1),this.bgSky.tilePositionY=this.cameras.main.scrollY*.1,this.bgMountains.tilePositionY=this.cameras.main.scrollY*.3,this.bgSky.y=this.cameras.main.scrollY,this.bgMountains.y=this.cameras.main.scrollY+200;const n=e/2-(((r=this.track[0])==null?void 0:r.lanes)||5)*h.LANE_WIDTH/2;if(this.players.forEach(l=>{const c=this.playerSprites.get(l.id);if(!c)return;const d=n+l.x,u=200+l.distanceTraveled;if(c.setPosition(d,u),l.isJumping?(c.setScale(1.1),c.y-=15):c.setScale(1),l.stunTimer>0?c.setAlpha(.5+Math.sin(this.elapsedTime*20)*.3):c.setAlpha(1),l.hasShield){const p=c.list[0];p&&p.setTint(5227511)}else{const p=c.list[0];p&&p.clearTint()}l.speedBoostTimer>0&&!l.isBot&&this.speedLineEmitter&&this.speedLineEmitter.emitParticleAt(d,u+20,2),c.setDepth(l.distanceTraveled)}),t.forwardSpeed>h.MAX_FORWARD_SPEED*.7&&this.splashEmitter){const l=this.playerSprites.get("player");l&&this.splashEmitter.emitParticleAt(l.x,l.y+15,2)}}showCountdown(){const{width:t,height:e}=this.cameras.main,i=this.add.text(t/2,e/2-50,"3",{fontSize:"72px",fontFamily:"Arial",color:"#FFD700",stroke:"#003566",strokeThickness:6}).setOrigin(.5).setScrollFactor(0).setDepth(1e3);let s=3;this.time.addEvent({delay:1e3,repeat:3,callback:()=>{s--,s>0?(i.setText(s.toString()),this.tweens.add({targets:i,scaleX:1.5,scaleY:1.5,duration:200,yoyo:!0})):s===0&&(i.setText("GO!"),i.setColor("#76FF03"),this.tweens.add({targets:i,scaleX:2,scaleY:2,alpha:0,duration:500,onComplete:()=>{i.destroy(),this.isCountingDown=!1,this.audioManager.playMusic()}}))}})}async endGame(){if(this.gameOver=!0,this.audioManager.stopMusic(),this.audioManager.playSfx("win"),!this.isReplay){const e={version:1,seed:this.seed,mode:this.mode,settings:this.settings,frames:this.replayFrames,startTime:Date.now(),playerName:"You"},i=this.players.find(n=>!n.isBot),s=`replay_${Date.now()}`;await y.saveReplay(s,e);const a=await y.loadStats();a.totalRuns++,i.finishPosition===1&&a.totalWins++,i.finishTime<a.bestTime&&(a.bestTime=i.finishTime),a.totalScore+=i.score,await y.saveStats(a)}const t=[...this.players].sort((e,i)=>e.finishPosition-i.finishPosition);this.time.delayedCall(1e3,()=>{this.scene.start("ResultsScene",{players:t,mode:this.mode,elapsedTime:this.elapsedTime})})}shutdown(){this.controls&&this.controls.destroy(),this.audioManager.stopMusic()}}function H(o){const t={v:o.version,s:o.seed,m:o.mode,f:o.frames.map(i=>({t:i.tick,i:(i.inputs.left?1:0)|(i.inputs.right?2:0)|(i.inputs.jump?4:0)}))},e=JSON.stringify(t);return btoa(e)}function q(o){try{const t=atob(o),e=JSON.parse(t);return{version:e.v,seed:e.s,mode:e.m,settings:{},frames:e.f.map(i=>({tick:i.t,inputs:{left:!!(i.i&1),right:!!(i.i&2),jump:!!(i.i&4)}})),startTime:0,playerName:"Replay"}}catch{return null}}class X extends f.Scene{constructor(){super({key:"ReplayScene"}),this.action="list"}init(t){this.action=t.action||"list",this.replayId=t.replayId}async create(){if(this.action==="play"&&this.replayId){await this.playReplay(this.replayId);return}await this.showReplayList()}async showReplayList(){const{width:t,height:e}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(13670,13670,30646,46296,1),i.fillRect(0,0,t,e),this.add.text(t/2,40,"REPLAYS",{fontSize:"32px",fontFamily:"Arial",color:"#FFFFFF",stroke:"#003566",strokeThickness:4}).setOrigin(.5);const s=await y.listReplays();if(s.length===0)this.add.text(t/2,e/2,`No replays saved yet.
Play some races first!`,{fontSize:"18px",fontFamily:"Arial",color:"#CAF0F8",align:"center"}).setOrigin(.5);else{let a=100;s.slice(0,10).forEach(n=>{this.createReplayRow(30,a,n,t),a+=60})}this.checkUrlReplay(),this.add.text(t/2,e-60,"Back to Menu",{fontSize:"18px",fontFamily:"Arial",color:"#CAF0F8"}).setOrigin(.5),this.add.zone(t/2,e-60,200,40).setInteractive().on("pointerdown",()=>{this.scene.start("MenuScene")})}createReplayRow(t,e,i,s){const a=this.add.graphics();a.fillStyle(13670,.6),a.fillRoundedRect(t,e,s-60,50,8);const n=new Date(i.date),r=`${n.getMonth()+1}/${n.getDate()} ${n.getHours()}:${n.getMinutes().toString().padStart(2,"0")}`;this.add.text(t+10,e+8,r,{fontSize:"12px",fontFamily:"Arial",color:"#90E0EF"}),this.add.text(t+10,e+28,`${i.mode} - #${i.position}`,{fontSize:"14px",fontFamily:"Arial",color:"#FFFFFF"}),this.add.text(t+180,e+18,`Score: ${i.score}`,{fontSize:"14px",fontFamily:"Arial",color:"#FFD700"});const l=this.add.graphics();l.fillStyle(46296,.9),l.fillRoundedRect(s-110,e+8,60,34,8),this.add.text(s-80,e+25,"Play",{fontSize:"14px",fontFamily:"Arial",color:"#FFFFFF"}).setOrigin(.5),this.add.zone(s-80,e+25,60,34).setInteractive().on("pointerdown",()=>{this.playReplay(i.id)});const c=this.add.graphics();c.fillStyle(13670,.9),c.fillRoundedRect(s-170,e+8,52,34,8),this.add.text(s-144,e+25,"Share",{fontSize:"12px",fontFamily:"Arial",color:"#CAF0F8"}).setOrigin(.5),this.add.zone(s-144,e+25,52,34).setInteractive().on("pointerdown",async()=>{await this.shareReplay(i.id)})}async playReplay(t){const e=await y.loadReplay(t);e&&this.scene.start("GameScene",{mode:e.mode,settings:e.settings,replay:e})}async shareReplay(t){const e=await y.loadReplay(t);if(!e)return;const i=H(e),s=`${window.location.origin}${window.location.pathname}#replay=${i}`;navigator.clipboard?(await navigator.clipboard.writeText(s),this.showToast("Replay link copied!")):this.showToast("Share not available")}checkUrlReplay(){const t=window.location.hash;if(t.startsWith("#replay=")){const e=t.substring(8);try{const i=q(e);i&&this.scene.start("GameScene",{mode:i.mode,settings:i.settings,replay:i})}catch{}}}showToast(t){const{width:e,height:i}=this.cameras.main,s=this.add.text(e/2,i-120,t,{fontSize:"16px",fontFamily:"Arial",color:"#FFFFFF",backgroundColor:"#003566",padding:{x:12,y:6}}).setOrigin(.5);this.tweens.add({targets:s,alpha:0,y:i-140,duration:2e3,delay:1e3,onComplete:()=>s.destroy()})}}class $ extends f.Scene{constructor(){super({key:"SettingsScene"}),this.sliders=new Map}async create(){this.settings=await y.loadSettings();const{width:t,height:e}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(13670,13670,30646,46296,1),i.fillRect(0,0,t,e),this.add.text(t/2,40,"SETTINGS",{fontSize:"32px",fontFamily:"Arial",color:"#FFFFFF",stroke:"#003566",strokeThickness:4}).setOrigin(.5);let s=100;const a=30;this.addSectionTitle(t/2,s,"Audio"),s+=35,this.addSlider(40,s,"Master Volume",this.settings.masterVolume,n=>{this.settings.masterVolume=n}),s+=50,this.addSlider(40,s,"Music",this.settings.musicVolume,n=>{this.settings.musicVolume=n}),s+=50,this.addSlider(40,s,"SFX",this.settings.sfxVolume,n=>{this.settings.sfxVolume=n}),s+=40,this.addToggle(40,s,"Mute All",this.settings.muted,n=>{this.settings.muted=n}),s+=a+30,this.addSectionTitle(t/2,s,"Controls"),s+=35,this.addOptionSelector(40,s,"Scheme",["buttons","swipe","tilt"],this.settings.controlScheme,n=>{this.settings.controlScheme=n}),s+=40,this.addToggle(40,s,"Tilt Steering",this.settings.tiltEnabled,n=>{this.settings.tiltEnabled=n}),s+=a+30,this.addSectionTitle(t/2,s,"Graphics"),s+=35,this.addOptionSelector(40,s,"Quality",["low","medium","high"],this.settings.quality,n=>{this.settings.quality=n}),s+=a+30,this.addSectionTitle(t/2,s,"Gameplay"),s+=35,this.addSlider(40,s,`Bots: ${this.settings.botCount}`,this.settings.botCount/15,n=>{this.settings.botCount=Math.max(1,Math.round(n*15))}),s+=50,this.addSlider(40,s,`Time: ${this.settings.matchLength}s`,this.settings.matchLength/120,n=>{this.settings.matchLength=Math.max(15,Math.round(n*120))}),this.addButton(t/2-80,e-80,"Save & Back",async()=>{await y.saveSettings(this.settings),x.getInstance().applySettings(this.settings),this.scene.start("MenuScene")}),this.addButton(t/2+80,e-80,"Reset",async()=>{this.settings={...w},await y.saveSettings(this.settings),this.scene.restart()})}addSectionTitle(t,e,i){this.add.text(t,e,i,{fontSize:"18px",fontFamily:"Arial",color:"#FFD700",fontStyle:"bold"}).setOrigin(.5);const s=this.add.graphics();s.lineStyle(1,16766720,.5),s.lineBetween(40,e+12,this.cameras.main.width-40,e+12)}addSlider(t,e,i,s,a){const n=this.cameras.main.width-80;this.add.text(t,e-10,i,{fontSize:"14px",fontFamily:"Arial",color:"#CAF0F8"});const r=this.add.graphics();r.fillStyle(13670,1),r.fillRoundedRect(t,e+8,n,8,4),r.fillStyle(46296,1),r.fillRoundedRect(t,e+8,n*s,8,4);const l=t+n*s,c=this.add.graphics();c.fillStyle(16777215,1),c.fillCircle(0,0,10),c.setPosition(l,e+12);const d=this.add.zone(t+n/2,e+12,n+20,30).setInteractive();d.on("pointerdown",u=>{const p=f.Math.Clamp((u.x-t)/n,0,1);c.setPosition(t+n*p,e+12),r.clear(),r.fillStyle(13670,1),r.fillRoundedRect(t,e+8,n,8,4),r.fillStyle(46296,1),r.fillRoundedRect(t,e+8,n*p,8,4),a(p)}),d.on("pointermove",u=>{if(!u.isDown)return;const p=f.Math.Clamp((u.x-t)/n,0,1);c.setPosition(t+n*p,e+12),r.clear(),r.fillStyle(13670,1),r.fillRoundedRect(t,e+8,n,8,4),r.fillStyle(46296,1),r.fillRoundedRect(t,e+8,n*p,8,4),a(p)})}addToggle(t,e,i,s,a){this.add.text(t,e,i,{fontSize:"14px",fontFamily:"Arial",color:"#CAF0F8"});const n=this.add.graphics(),r=this.add.graphics(),l=d=>{n.clear(),n.fillStyle(d?46296:13670,1),n.fillRoundedRect(280,e-2,50,24,12),r.clear(),r.fillStyle(16777215,1),r.fillCircle(d?318:292,e+10,10)};l(s);let c=s;this.add.zone(305,e+10,50,24).setInteractive().on("pointerdown",()=>{c=!c,l(c),a(c)})}addOptionSelector(t,e,i,s,a,n){this.add.text(t,e,i,{fontSize:"14px",fontFamily:"Arial",color:"#CAF0F8"});let r=s.indexOf(a);const l=80,c=140,d=[];s.forEach((p,g)=>{const T=c+g*(l+10),F=this.add.graphics();this.add.text(T+l/2,e+2,p,{fontSize:"12px",fontFamily:"Arial",color:"#FFFFFF"}).setOrigin(.5),d.push(F),this.add.zone(T+l/2,e+2,l,24).setInteractive().on("pointerdown",()=>{r=g,n(s[g]),u()})});const u=()=>{d.forEach((p,g)=>{p.clear();const T=c+g*(l+10);p.fillStyle(g===r?46296:13670,1),p.fillRoundedRect(T,e-10,l,24,8)})};u()}addButton(t,e,i,s){const a=this.add.graphics();a.fillStyle(30646,.9),a.fillRoundedRect(t-65,e-18,130,36,10),this.add.text(t,e,i,{fontSize:"14px",fontFamily:"Arial",color:"#FFFFFF"}).setOrigin(.5),this.add.zone(t,e,130,36).setInteractive().on("pointerdown",s)}}class J extends f.Scene{constructor(){super({key:"ResultsScene"}),this.players=[],this.elapsedTime=0}init(t){this.players=t.players||[],this.mode=t.mode||"classic",this.elapsedTime=t.elapsedTime||0}create(){const{width:t,height:e}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(13670,13670,30646,46296,1),i.fillRect(0,0,t,e),this.createConfetti(t,e);const s=this.players.find(c=>!c.isBot),a=s?this.getPositionText(s.finishPosition):"";this.add.text(t/2,60,"RACE COMPLETE!",{fontSize:"32px",fontFamily:"Arial",color:"#FFD700",stroke:"#003566",strokeThickness:4}).setOrigin(.5),s&&this.add.text(t/2,110,`You finished ${a}!`,{fontSize:"24px",fontFamily:"Arial",color:s.finishPosition===1?"#FFD700":"#FFFFFF"}).setOrigin(.5);const n=170,r=50;this.players.slice(0,8).forEach((c,d)=>{const u=n+d*r,p=!c.isBot,g=this.add.graphics();g.fillStyle(p?16766720:13670,p?.3:.5),g.fillRoundedRect(30,u-15,t-60,40,8),this.add.text(50,u,`#${c.finishPosition}`,{fontSize:"18px",fontFamily:"Arial",color:d===0?"#FFD700":d===1?"#C0C0C0":d===2?"#CD7F32":"#FFFFFF",fontStyle:"bold"}).setOrigin(0,.5);const T=this.add.graphics();T.fillStyle(v[c.skinIndex]||16777215,1),T.fillCircle(95,u,8),this.add.text(115,u,c.name,{fontSize:"16px",fontFamily:"Arial",color:p?"#FFE66D":"#CAF0F8"}).setOrigin(0,.5),this.add.text(250,u,this.formatTime(c.finishTime),{fontSize:"14px",fontFamily:"Arial",color:"#90E0EF"}).setOrigin(0,.5),this.add.text(340,u,`${c.score}`,{fontSize:"14px",fontFamily:"Arial",color:"#FFD700",fontStyle:"bold"}).setOrigin(1,.5)});const l=n+Math.min(this.players.length,8)*r+20;this.add.text(t/2,l,`Mode: ${this.mode} | Time: ${this.formatTime(this.elapsedTime)}`,{fontSize:"14px",fontFamily:"Arial",color:"#90E0EF"}).setOrigin(.5),this.createButton(t/2,l+60,"Play Again",()=>{this.scene.start("GameScene",{mode:this.mode})}),this.createButton(t/2,l+120,"Main Menu",()=>{this.scene.start("MenuScene")}),x.getInstance().playSfx("win")}createButton(t,e,i,s){const a=this.add.graphics();a.fillStyle(30646,.9),a.fillRoundedRect(t-100,e-22,200,44,12),a.lineStyle(2,13299960,1),a.strokeRoundedRect(t-100,e-22,200,44,12),this.add.text(t,e,i,{fontSize:"18px",fontFamily:"Arial",color:"#FFFFFF"}).setOrigin(.5),this.add.zone(t,e,200,44).setInteractive().on("pointerdown",s)}createConfetti(t,e){const i=[16739179,5164484,16770669,9822675,15958401,11179738];for(let s=0;s<40;s++){const a=this.add.rectangle(f.Math.Between(0,t),f.Math.Between(-50,-10),f.Math.Between(4,8),f.Math.Between(4,8),f.Utils.Array.GetRandom(i));this.tweens.add({targets:a,y:e+20,x:a.x+f.Math.Between(-50,50),angle:f.Math.Between(0,360),duration:f.Math.Between(2e3,4e3),repeat:-1,delay:f.Math.Between(0,2e3)})}}getPositionText(t){return t===1?"1st":t===2?"2nd":t===3?"3rd":`${t}th`}formatTime(t){const e=Math.floor(t/60),i=Math.floor(t%60),s=Math.floor(t%1*100);return`${e}:${i.toString().padStart(2,"0")}.${s.toString().padStart(2,"0")}`}}const K={type:f.AUTO,parent:"game-container",width:390,height:844,scale:{mode:f.Scale.FIT,autoCenter:f.Scale.CENTER_BOTH},backgroundColor:"#87CEEB",physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[_,C,G,J,X,$],render:{pixelArt:!1,antialias:!0},input:{activePointers:3}};new f.Game(K);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").catch(()=>{})});
